{% extends "base.html" %}
{% load bootstrap5 %}
{% load widget_tweaks %}
{% load bootstrap_icons %}

{% block content %}
<div class="container mt-4">
  <h1>Diagnosis and Chat History</h1>

  <div class="row mt-4">
    <!-- Diagnoses Section -->
    <!-- <div class="col-md-6">
      <div class="diagnoses-section">
        <h2>Your Diagnoses</h2>
        {% if diagnoses %}
          <div class="accordion" id="diagnosisAccordion">
            {% for diagnosis in diagnoses %}
              <div class="accordion-item">
                <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                  <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="true" aria-controls="collapse{{ forloop.counter }}">
                    {{ diagnosis.date_created|date:"F j, Y" }}  Display date in a more readable format -->
                  <!-- </button>
                </h2>
                <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#diagnosisAccordion">
                  <div class="accordion-body">
                    <strong>Symptoms:</strong> {{ diagnosis.symptoms }}<br>
                    <strong>Diagnosis:</strong> {{ diagnosis.diagnosis }}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p>You have no diagnosis history yet.</p>
        {% endif %}
      </div>
    </div> -->

        <!-- Chat History Section -->
        <div class="col-md-6">
          <div class="chat-history-section">
              <h2>Your Chat History</h2>
              {% if chat_sessions %}
                  <div class="accordion" id="chatAccordion">
                      {% for session in chat_sessions %}
                          <div class="accordion-item">
                              <h2 class="accordion-header" id="headingChat{{ forloop.counter }}">
                                  <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseChat{{ forloop.counter }}" aria-expanded="true" aria-controls="collapseChat{{ forloop.counter }}">
                                        {{ session.timestamp|date:"F j, Y" }}
                                  </button>
                              </h2>
                              <div id="collapseChat{{ forloop.counter }}" class="accordion-collapse collapse" aria-labelledby="headingChat{{ forloop.counter }}" data-bs-parent="#chatAccordion">
                                  <div class="accordion-body">
                                      <div class="list-group">
                                          {% for message in session.messages.all %}
                                              <div class="list-group-item d-flex justify-content-between align-items-center">
                                                  <div>
                                                      <strong>{{ message.sender }}:</strong> {{ message.content }}<br>
                                                      <small>{{ message.timestamp|date:"Y-m-d H:i" }}</small>
                                                  </div>
                                              </div>
                                          {% endfor %}
                                      </div>
                                      <form method="post" action="{% url 'delete_chat_session' session.id %}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this chat session?');">
                                          {% csrf_token %}
                                          <button type="submit" class="btn btn-danger btn-sm">
                                              Delete Chat Session
                                          </button>
                                      </form>
                                  </div>
                              </div>
                          </div>
                      {% endfor %}
                  </div>
              {% else %}
                  <p>You have no chat history yet. <a href="">Start a new chat!</a></p>
              {% endif %}
          </div>
      </div>      
  </div>
</div>
{% endblock %}
